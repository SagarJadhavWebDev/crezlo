'use client';
"use strict";var e=require("react/jsx-runtime"),t=require("react"),r=require("sonner");require("clsx"),require("tailwind-merge");var o=require("@aws-sdk/client-s3"),n=require("crypto");const s="production"===process.env.NODE_ENV?"https://":"http://",a=process.env.NEXT_PUBLIC_APP_DOMAIN,i=process.env.NEXT_PUBLIC_APP_URL_ACCOUNT||"accounts";process.env.NEXT_PUBLIC_APP_URL_FINANCE,process.env.NEXT_PUBLIC_APP_URL_VR,process.env.NEXT_PUBLIC_APP_URL_COMMUNITY,process.env.NEXT_PUBLIC_APP_URL_WEBSITE,process.env.NEXT_PUBLIC_APP_URL_GENAGENT;const c={APP_DOMAIN:"production"===process.env.NODE_ENV?a:"crezlo.local",APP_URL:{ACCOUNT:`${s}${i}.${a}`},SUBSCRIPTION_TYPE:process.env.NEXT_PUBLIC_SUBSCRIPTION_TYPE,BASE_API_URL:{CORE:process.env.NEXT_PUBLIC_API_URL_CORE,CONTENT:process.env.NEXT_PUBLIC_API_URL_CONTENT,CHAT:process.env.NEXT_PUBLIC_API_URL_CHAT,GENAGENT:process.env.NEXT_PUBLIC_API_GENAGENT_URL,WEBSITE_BUILDER:process.env.NEXT_PUBLIC_WEBSITE_BUILDER_URL,CHANNEL_BUILDER:process.env.NEXT_PUBLIC_CHANNEL_BUILDERL_URL,FINANCE:process.env.NEXT_PUBLIC_FINANCE_URL}};const l=new class{config;constructor(e={}){this.config={defaultPath:"/",defaultSecure:"undefined"!=typeof window&&"https:"===window.location.protocol,defaultDomain:`.${c.APP_DOMAIN}`,...e}}set(e,t,r={expires:1e3}){if("undefined"==typeof document)return console.warn("CookieManager: document is not available (SSR environment)"),!1;try{const o=this.config.prefix?`${this.config.prefix}${e}`:e;let n=`${encodeURIComponent(o)}=${encodeURIComponent(t)}`;if(r.expires)if("number"==typeof r.expires){const e=new Date;e.setTime(e.getTime()+24*r.expires*60*60*1e3),n+=`; expires=${e.toUTCString()}`}else n+=`; expires=${r.expires.toUTCString()}`;void 0!==r.maxAge&&(n+=`; max-age=${r.maxAge}`);const s=r.path??this.config.defaultPath;s&&(n+=`; path=${s}`);const a=r.domain??this.config.defaultDomain;a&&(n+=`; domain=${a}`);(r.secure??this.config.defaultSecure)&&(n+="; secure"),r.httpOnly&&console.warn("CookieManager: httpOnly flag cannot be set via JavaScript");const i=r.sameSite??this.config.defaultSameSite;return i&&(n+=`; samesite=${i}`),console.log("Setting cookie:",n),document.cookie=n,!0}catch(e){return console.error("CookieManager: Error setting cookie:",e),!1}}get(e){if("undefined"==typeof document)return null;try{const t=this.config.prefix?`${this.config.prefix}${e}`:e,r=encodeURIComponent(t),o=document.cookie.split(";");for(let e of o)if(e=e.trim(),e.startsWith(`${r}=`))return decodeURIComponent(e.substring(r.length+1));return null}catch(e){return console.error("CookieManager: Error getting cookie",e),null}}getJSON(e){const t=this.get(e);if(null===t)return null;try{return JSON.parse(t)}catch(e){return console.error("CookieManager: Error parsing JSON cookie",e),null}}setJSON(e,t,r={}){try{const o=JSON.stringify(t);return this.set(e,o,r)}catch(e){return console.error("CookieManager: Error stringifying JSON cookie",e),!1}}remove(e,t={}){return this.set(e,"",{...t,expires:new Date(0),maxAge:0})}has(e){return null!==this.get(e)}getAll(){if("undefined"==typeof document)return{};try{const e={},t=document.cookie.split(";");for(let r of t){r=r.trim();const[t,...o]=r.split("=");if(t&&o.length>0){const r=decodeURIComponent(t),n=decodeURIComponent(o.join("="));e[this.config.prefix&&r.startsWith(this.config.prefix)?r.substring(this.config.prefix.length):r]=n}}return e}catch(e){return console.error("CookieManager: Error getting all cookies",e),{}}}clear(e={}){const t=this.getAll();Object.keys(t).forEach(t=>{this.remove(t,e)})}getSize(e){const t=this.get(e);return null===t?0:new Blob([t]).size}getTotalSize(){return"undefined"==typeof document?0:new Blob([document.cookie]).size}isEnabled(){if("undefined"==typeof document)return!1;try{const e="__cookie_test__";this.set(e,"test");const t=this.has(e);return this.remove(e),t}catch{return!1}}},u=(e,t)=>l.remove(e,t),p=()=>{const e=(t="token",l.getJSON(t));var t;return e?.access_token?e:null},d={request:[],response:[],error:[]};class h{static instances=new Map;config;localInterceptors;constructor(e){this.config=e,this.localInterceptors={request:[],response:[],error:[]}}static getInstance(e){const t=e.baseURL;if(t)return h.instances.has(t)||h.instances.set(t,new h(e)),h.instances.get(t)}static addGlobalRequestInterceptor(e){d.request.push(e)}static addGlobalResponseInterceptor(e){d.response.push(e)}static addGlobalErrorInterceptor(e){d.error.push(e)}addRequestInterceptor(e){this.localInterceptors.request.push(e)}addResponseInterceptor(e){this.localInterceptors.response.push(e)}addErrorInterceptor(e){this.localInterceptors.error.push(e)}async applyInterceptors(e,t){const r=[...d[e],...this.localInterceptors[e]];let o=t;for(const e of r)o=await e(o);return o}buildURL(e,t){const r=new URL(e,this.config.baseURL);return t&&Object.entries(t).forEach(([e,t])=>{r.searchParams.append(e,String(t))}),r.toString()}async request(e,t={}){try{const r=await this.applyInterceptors("request",t),o=this.buildURL(e,r.params),n={"Content-Type":"application/json",Accept:"application/json",...this.config.headers,...r.headers},s={method:r.method||"GET",headers:n,credentials:r.withCredentials??this.config.withCredentials?"include":"same-origin"};r.body&&"GET"!==r.method&&(s.body="string"==typeof r.body?r.body:JSON.stringify(r.body));const a=r.timeout||this.config.timeout||1e4,i=new AbortController,c=setTimeout(()=>i.abort(),a);s.signal=i.signal;const l=await fetch(o,s);let u;clearTimeout(c);const p=l.headers.get("content-type");u=p&&p.includes("application/json")?await l.json():await l.text();const d=u;if(!l.ok||l.status<200||l.status>=300){const e=u;throw await this.applyInterceptors("error",e)}return await this.applyInterceptors("response",d)}catch(e){if(e instanceof Error){const t={message:e.message,code:"REQUEST_ERROR",status_code:500};throw await this.applyInterceptors("error",t)}throw e}}async get(e,t){return this.request(e,{...t,method:"GET"})}async post(e,t,r){return this.request(e,{...r,method:"POST",body:t})}async put(e,t,r){return this.request(e,{...r,method:"PUT",body:t})}async patch(e,t,r){return this.request(e,{...r,method:"PATCH",body:t})}async delete(e,t){return this.request(e,{...t,method:"DELETE"})}}const _=c.BASE_API_URL;h.addGlobalErrorInterceptor(async e=>(console.log("❌ API ERROR:",e),e?.message&&r.toast.error(e.message),e)),h.addGlobalResponseInterceptor(async e=>(console.log("✅ Response received:",e),e?.message&&r.toast.success(e.message),e));const E={client:{addGlobalRequestInterceptor:h.addGlobalRequestInterceptor,addGlobalResponseInterceptor:h.addGlobalResponseInterceptor,addGlobalErrorInterceptor:h.addGlobalErrorInterceptor,getInstance:h.getInstance},...Object.fromEntries(Object.entries(_).map(([e,t])=>{return[e,(r=t,h.getInstance({baseURL:r}))];var r}))},g=process.env.NEXT_PUBLIC_R2_ACCOUNT_ID,f=process.env.NEXT_PUBLIC_AWS_S3_PUBLIC_BUCKET,I=process.env.NEXT_PUBLIC_AWS_ACCESS_KEY_ID,C=process.env.NEXT_PUBLIC_AWS_SECRET_ACCESS_KEY;if(!(g&&f&&I&&C))throw new Error("Missing required environment variables for R2 configuration");n.createHash("sha256").update(C).digest("hex");const R=new o.S3Client({endpoint:`https://${g}.r2.cloudflarestorage.com`,region:"auto",credentials:{accessKeyId:I,secretAccessKey:C},signatureVersion:"v4"});console.log("s3Client  Data",R.config.endpoint,R.config.credentials);const T={profile:"profile"},y={tokenStorage:{cookieOptions:{secure:!0,sameSite:"lax",path:"/"}},redirectOnUnauthorized:c.APP_URL.ACCOUNT+"/login",isAccountDomain:!1,onAuthStateChange:()=>{}},U={user:null,token:{access_token:null,expires_at:null,token_type:null},isAuthenticated:!1,isLoading:!0,error:null},A=(e,t)=>{switch(t.type){case"SET_LOADING":return{...e,isLoading:t.payload};case"SET_ERROR":return{...e,error:t.payload,isLoading:!1};case"SET_USER":return{...e,user:t.payload,isAuthenticated:!!t.payload,error:null};case"SET_TOKENS":return{...e,token:t.payload};case"SET_AUTHENTICATED":return{...e,isAuthenticated:t.payload};case"UPDATE_USER":return{...e,user:e.user?{...e.user,...t.payload}:null};case"CLEAR_AUTH":return{...U,isLoading:!1};default:return e}},S=t.createContext(void 0),m=t.createContext({sidebarOpen:!0,setSidebarOpen:e=>{},sidebarExpanded:!0,setSidebarExpanded:e=>{}});exports.AppProvider=function({children:r}){const[o,n]=t.useState(!0),[s,a]=t.useState(!0);return e.jsx(m.Provider,{value:{sidebarOpen:o,setSidebarOpen:n,sidebarExpanded:s,setSidebarExpanded:a},children:r})},exports.AuthContext=S,exports.AuthProvider=({children:r,config:o})=>{const[n,s]=t.useReducer(A,U),a={...y,...o??{}},i=t.useCallback(e=>{var t,r,o;t="token",r=e,l.setJSON(t,r,o),((e,t,r)=>{l.set(e,t,r)})("auth",e?.access_token),s({type:"SET_TOKENS",payload:e})},[]),c=t.useCallback(e=>{(e=>{u("token"),u("auth"),e?.()})(()=>{s({type:"CLEAR_AUTH"}),e?.()})},[]),d=t.useCallback(()=>{const e=p();return e?.access_token||((()=>{if("undefined"!=typeof window){const e=window?.location?.hostname;return e?.split(".")?.[0]}})(),a?.isAccountDomain?window.location.pathname="/login":window.location.assign(a.redirectOnUnauthorized+`?redirect_url=${window.location.href}`)),e},[]);t.useEffect(()=>{E.client.addGlobalRequestInterceptor(async e=>{const t=d();return t?.access_token&&(e.headers={...e.headers,Authorization:`Bearer ${t?.access_token}`}),e}),E.client.addGlobalErrorInterceptor(async e=>{if(401===e.status_code)try{c(()=>{})}catch(e){console.error("Token refresh failed:",e),s({type:"SET_ERROR",payload:"Session expired. Please log in again."})}return e}),h()},[]);const h=t.useCallback(async()=>{s({type:"SET_LOADING",payload:!0}),s({type:"SET_ERROR",payload:null}),E.CORE.get(T.profile).then(e=>{const t=e?.data?.seller;_(t)}).catch(e=>{s({type:"SET_ERROR",payload:e.message||"Login failed"})}).finally(()=>{s({type:"SET_LOADING",payload:!1})})},[]),_=t.useCallback(e=>{s({type:"SET_USER",payload:e})},[]);t.useCallback(()=>{s({type:"SET_ERROR",payload:null})},[]),t.useEffect(()=>{a.onAuthStateChange(n)},[n,a.onAuthStateChange]);const g={...n,setUser:_,getToken:d,updateToken:i,logout:c,refreshUser:h,config:a};return e.jsx(S.Provider,{value:g,children:r})},exports.useAppProvider=()=>t.useContext(m),exports.useAuth=()=>t.useContext(S);
//# sourceMappingURL=index.js.map
