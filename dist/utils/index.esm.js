import{useState as e,useEffect as t}from"react";import{toast as o}from"sonner";import{clsx as r}from"clsx";import{twMerge as n}from"tailwind-merge";import{S3Client as s,DeleteObjectCommand as c,CreateMultipartUploadCommand as a,UploadPartCommand as i,CompleteMultipartUploadCommand as l,AbortMultipartUploadCommand as d}from"@aws-sdk/client-s3";import{createHash as p}from"crypto";process.env.NODE_ENV;const u=process.env.NEXT_PUBLIC_APP_DOMAIN;process.env.NEXT_PUBLIC_APP_URL_ACCOUNT,process.env.NEXT_PUBLIC_APP_URL_FINANCE,process.env.NEXT_PUBLIC_APP_URL_VR,process.env.NEXT_PUBLIC_APP_URL_COMMUNITY,process.env.NEXT_PUBLIC_APP_URL_WEBSITE,process.env.NEXT_PUBLIC_APP_URL_GENAGENT;const h={APP_DOMAIN:"production"===process.env.NODE_ENV?u:"crezlo.local",SUBSCRIPTION_TYPE:process.env.NEXT_PUBLIC_SUBSCRIPTION_TYPE,BASE_API_URL:{CORE:process.env.NEXT_PUBLIC_API_URL_CORE,CONTENT:process.env.NEXT_PUBLIC_API_URL_CONTENT,CHAT:process.env.NEXT_PUBLIC_API_URL_CHAT,GENAGENT:process.env.NEXT_PUBLIC_API_GENAGENT_URL,WEBSITE_BUILDER:process.env.NEXT_PUBLIC_WEBSITE_BUILDER_URL,CHANNEL_BUILDER:process.env.NEXT_PUBLIC_CHANNEL_BUILDERL_URL,FINANCE:process.env.NEXT_PUBLIC_FINANCE_URL}};class g{config;constructor(e={}){this.config={defaultPath:"/",defaultSecure:"undefined"!=typeof window&&"https:"===window.location.protocol,defaultDomain:`.${h.APP_DOMAIN}`,...e}}set(e,t,o={expires:1e3}){if("undefined"==typeof document)return console.warn("CookieManager: document is not available (SSR environment)"),!1;try{const r=this.config.prefix?`${this.config.prefix}${e}`:e;let n=`${encodeURIComponent(r)}=${encodeURIComponent(t)}`;if(o.expires)if("number"==typeof o.expires){const e=new Date;e.setTime(e.getTime()+24*o.expires*60*60*1e3),n+=`; expires=${e.toUTCString()}`}else n+=`; expires=${o.expires.toUTCString()}`;void 0!==o.maxAge&&(n+=`; max-age=${o.maxAge}`);const s=o.path??this.config.defaultPath;s&&(n+=`; path=${s}`);const c=o.domain??this.config.defaultDomain;c&&(n+=`; domain=${c}`);(o.secure??this.config.defaultSecure)&&(n+="; secure"),o.httpOnly&&console.warn("CookieManager: httpOnly flag cannot be set via JavaScript");const a=o.sameSite??this.config.defaultSameSite;return a&&(n+=`; samesite=${a}`),console.log("Setting cookie:",n),document.cookie=n,!0}catch(e){return console.error("CookieManager: Error setting cookie:",e),!1}}get(e){if("undefined"==typeof document)return null;try{const t=this.config.prefix?`${this.config.prefix}${e}`:e,o=encodeURIComponent(t),r=document.cookie.split(";");for(let e of r)if(e=e.trim(),e.startsWith(`${o}=`))return decodeURIComponent(e.substring(o.length+1));return null}catch(e){return console.error("CookieManager: Error getting cookie",e),null}}getJSON(e){const t=this.get(e);if(null===t)return null;try{return JSON.parse(t)}catch(e){return console.error("CookieManager: Error parsing JSON cookie",e),null}}setJSON(e,t,o={}){try{const r=JSON.stringify(t);return this.set(e,r,o)}catch(e){return console.error("CookieManager: Error stringifying JSON cookie",e),!1}}remove(e,t={}){return this.set(e,"",{...t,expires:new Date(0),maxAge:0})}has(e){return null!==this.get(e)}getAll(){if("undefined"==typeof document)return{};try{const e={},t=document.cookie.split(";");for(let o of t){o=o.trim();const[t,...r]=o.split("=");if(t&&r.length>0){const o=decodeURIComponent(t),n=decodeURIComponent(r.join("="));e[this.config.prefix&&o.startsWith(this.config.prefix)?o.substring(this.config.prefix.length):o]=n}}return e}catch(e){return console.error("CookieManager: Error getting all cookies",e),{}}}clear(e={}){const t=this.getAll();Object.keys(t).forEach(t=>{this.remove(t,e)})}getSize(e){const t=this.get(e);return null===t?0:new Blob([t]).size}getTotalSize(){return"undefined"==typeof document?0:new Blob([document.cookie]).size}isEnabled(){if("undefined"==typeof document)return!1;try{const e="__cookie_test__";this.set(e,"test");const t=this.has(e);return this.remove(e),t}catch{return!1}}}const f=new g,E=(e,t,o)=>f.set(e,t,o),m=e=>f.get(e),_=e=>f.getJSON(e),I=(e,t,o)=>f.setJSON(e,t,o),w=(e,t)=>f.remove(e,t),y=e=>f.has(e),U=()=>f.getAll(),C=e=>f.clear(e),T=()=>f.isEnabled(),N=e=>new g(e),P=()=>{const[o,r]=e("undefined"!=typeof window?window.innerWidth:void 0);return t(()=>{if("undefined"==typeof window)return;const e=()=>{r(window.innerWidth)};return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)},[]),o},R={request:[],response:[],error:[]};class A{static instances=new Map;config;localInterceptors;constructor(e){this.config=e,this.localInterceptors={request:[],response:[],error:[]}}static getInstance(e){const t=e.baseURL;if(t)return A.instances.has(t)||A.instances.set(t,new A(e)),A.instances.get(t)}static addGlobalRequestInterceptor(e){R.request.push(e)}static addGlobalResponseInterceptor(e){R.response.push(e)}static addGlobalErrorInterceptor(e){R.error.push(e)}addRequestInterceptor(e){this.localInterceptors.request.push(e)}addResponseInterceptor(e){this.localInterceptors.response.push(e)}addErrorInterceptor(e){this.localInterceptors.error.push(e)}async applyInterceptors(e,t){const o=[...R[e],...this.localInterceptors[e]];let r=t;for(const e of o)r=await e(r);return r}buildURL(e,t){const o=new URL(e,this.config.baseURL);return t&&Object.entries(t).forEach(([e,t])=>{o.searchParams.append(e,String(t))}),o.toString()}async request(e,t={}){try{const o=await this.applyInterceptors("request",t),r=this.buildURL(e,o.params),n={"Content-Type":"application/json",Accept:"application/json",...this.config.headers,...o.headers},s={method:o.method||"GET",headers:n,credentials:o.withCredentials??this.config.withCredentials?"include":"same-origin"};o.body&&"GET"!==o.method&&(s.body="string"==typeof o.body?o.body:JSON.stringify(o.body));const c=o.timeout||this.config.timeout||1e4,a=new AbortController,i=setTimeout(()=>a.abort(),c);s.signal=a.signal;const l=await fetch(r,s);let d;clearTimeout(i);const p=l.headers.get("content-type");d=p&&p.includes("application/json")?await l.json():await l.text();const u=d;if(!l.ok||l.status<200||l.status>=300){const e=d;throw await this.applyInterceptors("error",e)}return await this.applyInterceptors("response",u)}catch(e){if(e instanceof Error){const t={message:e.message,code:"REQUEST_ERROR",status_code:500};throw await this.applyInterceptors("error",t)}throw e}}async get(e,t){return this.request(e,{...t,method:"GET"})}async post(e,t,o){return this.request(e,{...o,method:"POST",body:t})}async put(e,t,o){return this.request(e,{...o,method:"PUT",body:t})}async patch(e,t,o){return this.request(e,{...o,method:"PATCH",body:t})}async delete(e,t){return this.request(e,{...t,method:"DELETE"})}}const L=h.BASE_API_URL;A.addGlobalErrorInterceptor(async e=>(console.log("❌ API ERROR:",e),e?.message&&o.error(e.message),e)),A.addGlobalResponseInterceptor(async e=>(console.log("✅ Response received:",e),e?.message&&o.success(e.message),e));const S={client:{addGlobalRequestInterceptor:A.addGlobalRequestInterceptor,addGlobalResponseInterceptor:A.addGlobalResponseInterceptor,addGlobalErrorInterceptor:A.addGlobalErrorInterceptor,getInstance:A.getInstance},...Object.fromEntries(Object.entries(L).map(([e,t])=>{return[e,(o=t,A.getInstance({baseURL:o}))];var o}))},b=()=>{const e=_("token");return e?.access_token?e:null},B=e=>{w("token"),w("auth"),e?.()};function v(...e){return n(r(e))}const O=e=>{const t=process.env.NEXT_PUBLIC_AWS_URL;return e?`${t}${e}`:null},k=e=>{if(!e)return"";const t=e.split("@")[0].split("."),o=t[0]?.charAt(0).toUpperCase()||"",r=t[1]?.charAt(0).toUpperCase()||"";return r?`${o}${r}`:`${o}`},$=()=>{const e=document.getElementById("preview-frame");return e?e?.contentDocument||e?.contentWindow?.document:document},x=process.env.NEXT_PUBLIC_R2_ACCOUNT_ID,D=process.env.NEXT_PUBLIC_AWS_S3_PUBLIC_BUCKET,G=process.env.NEXT_PUBLIC_AWS_ACCESS_KEY_ID,M=process.env.NEXT_PUBLIC_AWS_SECRET_ACCESS_KEY;if(!(x&&D&&G&&M))throw new Error("Missing required environment variables for R2 configuration");const X={CORSRules:[{AllowedHeaders:["*"],AllowedMethods:["PUT","POST","HEAD","GET"],AllowedOrigins:["http://localhost:3000"],ExposeHeaders:[],MaxAgeSeconds:3e3}]};p("sha256").update(M).digest("hex");const q=new s({endpoint:`https://${x}.r2.cloudflarestorage.com`,region:"auto",credentials:{accessKeyId:G,secretAccessKey:M},signatureVersion:"v4"});console.log("s3Client  Data",q.config.endpoint,q.config.credentials);const K=5242880,W=async(e,t,o,r,n,s=new Date(Date.now()).toLocaleDateString("en-GB"))=>{const c=(e=>{if(!(e instanceof File))throw new Error("Invalid file object provided");console.log("File size:",e.size,"Chunk size:",K);const t=[];let o=0;for(;o<e.size;){const r=e.slice(o,o+K);t.push(r),o+=K}return console.log("Total chunks created:",t.length),t})(e);console.log("Starting upload to bucket:",D);const a=await j(t,o,s,e),i=c.map((e,o)=>z(a,e,o+1,t,s).then(e=>{const t=Math.round((o+1)/c.length*100);return n({[r]:t}),e}));try{const e=await Promise.all(i),o=await F(a,e,t,s);return n({[r]:100}),o}catch(e){throw console.error("Upload failed:",e),await J(a,t,s),e}},j=async(e,t,o,r)=>{await r.arrayBuffer();const n=new a({Bucket:D,Key:`${o}${e}`,ContentType:t,ACL:"public-read",...X});console.log("command",n);try{const e=await q.send(n);if(!e.UploadId)throw new Error("UploadId not returned from R2");return console.log("Upload initiated with ID:",e),e.UploadId}catch(e){throw console.error("Failed to initiate multipart upload:",e),e}},z=async(e,t,o,r,n)=>{const s=await t.arrayBuffer(),c=new Uint8Array(s),a=new i({Bucket:D,Key:`${n}${r}`,PartNumber:o,UploadId:e,Body:c,...X});try{const e=await q.send(a);if(!e.ETag)throw new Error(`No ETag returned for part ${o}`);return console.log(`Uploaded part ${o}:`,e.ETag),{ETag:e.ETag,PartNumber:o}}catch(e){throw console.error(`Failed to upload part ${o}:`,e),e}},F=async(e,t,o,r)=>{const n=t.sort((e,t)=>e.PartNumber-t.PartNumber),s=new l({Bucket:D,Key:`${r}${o}`,UploadId:e,MultipartUpload:{Parts:n},...X});try{const e=await q.send(s);if(!e.Key)throw new Error("No Key returned after completing upload");return console.log("Upload completed successfully. Key:",e.Key),e.Key}catch(e){throw console.error("Failed to complete multipart upload:",e),e}},J=async(e,t,o)=>{const r=new d({Bucket:D,Key:`${o}${t}`,UploadId:e,...X});try{await q.send(r),console.log("Multipart upload aborted successfully:",e)}catch(e){throw console.error("Failed to abort multipart upload:",e),e}},H=async(e,t)=>{const o=new c({Bucket:D,Key:e,...X});try{const r=await q.send(o);return console.log("File deleted successfully:",e),t&&t({loaded:1,total:1}),{ETag:r.DeleteMarker?.toString()}}catch(e){throw console.error("Failed to delete file:",e),e}},Y=e=>{const t=new URLSearchParams;return Object.keys(e).forEach(o=>{e[o]&&t.set(o,e[o])}),t};export{S as ApiInstance,g as CookieManager,C as clearAllCookies,v as cn,f as cookieManager,N as createCookieManager,H as deleteFile,U as getAllCookies,b as getAuthToken,m as getCookie,_ as getCookieJSON,O as getFullImageUrl,$ as getIframeDocument,k as getInitialsFromEmail,y as hasCookie,T as isCookiesEnabled,B as logoutAuthUser,Y as paramsToQueryParams,w as removeCookie,E as setCookie,I as setCookieJSON,W as uploadFileInChunks,P as useWindowWidth};
//# sourceMappingURL=index.esm.js.map
