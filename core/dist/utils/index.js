"use strict";var e=require("react"),t=require("sonner"),o=require("clsx"),r=require("tailwind-merge"),n=require("@aws-sdk/client-s3"),s=require("crypto");process.env.NODE_ENV;const a=process.env.NEXT_PUBLIC_APP_DOMAIN;process.env.NEXT_PUBLIC_APP_URL_ACCOUNT,process.env.NEXT_PUBLIC_APP_URL_FINANCE,process.env.NEXT_PUBLIC_APP_URL_VR,process.env.NEXT_PUBLIC_APP_URL_COMMUNITY,process.env.NEXT_PUBLIC_APP_URL_WEBSITE,process.env.NEXT_PUBLIC_APP_URL_GENAGENT;const c={APP_DOMAIN:"production"===process.env.NODE_ENV?a:"crezlo.local",SUBSCRIPTION_TYPE:process.env.NEXT_PUBLIC_SUBSCRIPTION_TYPE,BASE_API_URL:{CORE:process.env.NEXT_PUBLIC_API_URL_CORE,CONTENT:process.env.NEXT_PUBLIC_API_URL_CONTENT,CHAT:process.env.NEXT_PUBLIC_API_URL_CHAT,GENAGENT:process.env.NEXT_PUBLIC_API_GENAGENT_URL,WEBSITE_BUILDER:process.env.NEXT_PUBLIC_WEBSITE_BUILDER_URL,CHANNEL_BUILDER:process.env.NEXT_PUBLIC_CHANNEL_BUILDERL_URL,FINANCE:process.env.NEXT_PUBLIC_FINANCE_URL}};class i{config;constructor(e={}){this.config={defaultPath:"/",defaultSecure:"undefined"!=typeof window&&"https:"===window.location.protocol,defaultDomain:`.${c.APP_DOMAIN}`,...e}}set(e,t,o={expires:1e3}){if("undefined"==typeof document)return console.warn("CookieManager: document is not available (SSR environment)"),!1;try{const r=this.config.prefix?`${this.config.prefix}${e}`:e;let n=`${encodeURIComponent(r)}=${encodeURIComponent(t)}`;if(o.expires)if("number"==typeof o.expires){const e=new Date;e.setTime(e.getTime()+24*o.expires*60*60*1e3),n+=`; expires=${e.toUTCString()}`}else n+=`; expires=${o.expires.toUTCString()}`;void 0!==o.maxAge&&(n+=`; max-age=${o.maxAge}`);const s=o.path??this.config.defaultPath;s&&(n+=`; path=${s}`);const a=o.domain??this.config.defaultDomain;a&&(n+=`; domain=${a}`);(o.secure??this.config.defaultSecure)&&(n+="; secure"),o.httpOnly&&console.warn("CookieManager: httpOnly flag cannot be set via JavaScript");const c=o.sameSite??this.config.defaultSameSite;return c&&(n+=`; samesite=${c}`),console.log("Setting cookie:",n),document.cookie=n,!0}catch(e){return console.error("CookieManager: Error setting cookie:",e),!1}}get(e){if("undefined"==typeof document)return null;try{const t=this.config.prefix?`${this.config.prefix}${e}`:e,o=encodeURIComponent(t),r=document.cookie.split(";");for(let e of r)if(e=e.trim(),e.startsWith(`${o}=`))return decodeURIComponent(e.substring(o.length+1));return null}catch(e){return console.error("CookieManager: Error getting cookie",e),null}}getJSON(e){const t=this.get(e);if(null===t)return null;try{return JSON.parse(t)}catch(e){return console.error("CookieManager: Error parsing JSON cookie",e),null}}setJSON(e,t,o={}){try{const r=JSON.stringify(t);return this.set(e,r,o)}catch(e){return console.error("CookieManager: Error stringifying JSON cookie",e),!1}}remove(e,t={}){return this.set(e,"",{...t,expires:new Date(0),maxAge:0})}has(e){return null!==this.get(e)}getAll(){if("undefined"==typeof document)return{};try{const e={},t=document.cookie.split(";");for(let o of t){o=o.trim();const[t,...r]=o.split("=");if(t&&r.length>0){const o=decodeURIComponent(t),n=decodeURIComponent(r.join("="));e[this.config.prefix&&o.startsWith(this.config.prefix)?o.substring(this.config.prefix.length):o]=n}}return e}catch(e){return console.error("CookieManager: Error getting all cookies",e),{}}}clear(e={}){const t=this.getAll();Object.keys(t).forEach(t=>{this.remove(t,e)})}getSize(e){const t=this.get(e);return null===t?0:new Blob([t]).size}getTotalSize(){return"undefined"==typeof document?0:new Blob([document.cookie]).size}isEnabled(){if("undefined"==typeof document)return!1;try{const e="__cookie_test__";this.set(e,"test");const t=this.has(e);return this.remove(e),t}catch{return!1}}}const l=new i,p=e=>l.getJSON(e),d=(e,t)=>l.remove(e,t),u={request:[],response:[],error:[]};class h{static instances=new Map;config;localInterceptors;constructor(e){this.config=e,this.localInterceptors={request:[],response:[],error:[]}}static getInstance(e){const t=e.baseURL;if(t)return h.instances.has(t)||h.instances.set(t,new h(e)),h.instances.get(t)}static addGlobalRequestInterceptor(e){u.request.push(e)}static addGlobalResponseInterceptor(e){u.response.push(e)}static addGlobalErrorInterceptor(e){u.error.push(e)}addRequestInterceptor(e){this.localInterceptors.request.push(e)}addResponseInterceptor(e){this.localInterceptors.response.push(e)}addErrorInterceptor(e){this.localInterceptors.error.push(e)}async applyInterceptors(e,t){const o=[...u[e],...this.localInterceptors[e]];let r=t;for(const e of o)r=await e(r);return r}buildURL(e,t){const o=new URL(e,this.config.baseURL);return t&&Object.entries(t).forEach(([e,t])=>{o.searchParams.append(e,String(t))}),o.toString()}async request(e,t={}){try{const o=await this.applyInterceptors("request",t),r=this.buildURL(e,o.params),n={"Content-Type":"application/json",Accept:"application/json",...this.config.headers,...o.headers},s={method:o.method||"GET",headers:n,credentials:o.withCredentials??this.config.withCredentials?"include":"same-origin"};o.body&&"GET"!==o.method&&(s.body="string"==typeof o.body?o.body:JSON.stringify(o.body));const a=o.timeout||this.config.timeout||1e4,c=new AbortController,i=setTimeout(()=>c.abort(),a);s.signal=c.signal;const l=await fetch(r,s);let p;clearTimeout(i);const d=l.headers.get("content-type");p=d&&d.includes("application/json")?await l.json():await l.text();const u=p;if(!l.ok||l.status<200||l.status>=300){const e=p;throw await this.applyInterceptors("error",e)}return await this.applyInterceptors("response",u)}catch(e){if(e instanceof Error){const t={message:e.message,code:"REQUEST_ERROR",status_code:500};throw await this.applyInterceptors("error",t)}throw e}}async get(e,t){return this.request(e,{...t,method:"GET"})}async post(e,t,o){return this.request(e,{...o,method:"POST",body:t})}async put(e,t,o){return this.request(e,{...o,method:"PUT",body:t})}async patch(e,t,o){return this.request(e,{...o,method:"PATCH",body:t})}async delete(e,t){return this.request(e,{...t,method:"DELETE"})}}const g=c.BASE_API_URL;h.addGlobalErrorInterceptor(async e=>(console.log("❌ API ERROR:",e),e?.message&&t.toast.error(e.message),e)),h.addGlobalResponseInterceptor(async e=>(console.log("✅ Response received:",e),e?.message&&t.toast.success(e.message),e));const f={client:{addGlobalRequestInterceptor:h.addGlobalRequestInterceptor,addGlobalResponseInterceptor:h.addGlobalResponseInterceptor,addGlobalErrorInterceptor:h.addGlobalErrorInterceptor,getInstance:h.getInstance},...Object.fromEntries(Object.entries(g).map(([e,t])=>{return[e,(o=t,h.getInstance({baseURL:o}))];var o}))};const E=process.env.NEXT_PUBLIC_R2_ACCOUNT_ID,m=process.env.NEXT_PUBLIC_AWS_S3_PUBLIC_BUCKET,I=process.env.NEXT_PUBLIC_AWS_ACCESS_KEY_ID,_=process.env.NEXT_PUBLIC_AWS_SECRET_ACCESS_KEY;if(!(E&&m&&I&&_))throw new Error("Missing required environment variables for R2 configuration");const C={CORSRules:[{AllowedHeaders:["*"],AllowedMethods:["PUT","POST","HEAD","GET"],AllowedOrigins:["http://localhost:3000"],ExposeHeaders:[],MaxAgeSeconds:3e3}]};s.createHash("sha256").update(_).digest("hex");const w=new n.S3Client({endpoint:`https://${E}.r2.cloudflarestorage.com`,region:"auto",credentials:{accessKeyId:I,secretAccessKey:_},signatureVersion:"v4"});console.log("s3Client  Data",w.config.endpoint,w.config.credentials);const U=5242880,y=async(e,t,o,r)=>{await r.arrayBuffer();const s=new n.CreateMultipartUploadCommand({Bucket:m,Key:`${o}${e}`,ContentType:t,ACL:"public-read",...C});console.log("command",s);try{const e=await w.send(s);if(!e.UploadId)throw new Error("UploadId not returned from R2");return console.log("Upload initiated with ID:",e),e.UploadId}catch(e){throw console.error("Failed to initiate multipart upload:",e),e}},T=async(e,t,o,r,s)=>{const a=await t.arrayBuffer(),c=new Uint8Array(a),i=new n.UploadPartCommand({Bucket:m,Key:`${s}${r}`,PartNumber:o,UploadId:e,Body:c,...C});try{const e=await w.send(i);if(!e.ETag)throw new Error(`No ETag returned for part ${o}`);return console.log(`Uploaded part ${o}:`,e.ETag),{ETag:e.ETag,PartNumber:o}}catch(e){throw console.error(`Failed to upload part ${o}:`,e),e}},N=async(e,t,o,r)=>{const s=t.sort((e,t)=>e.PartNumber-t.PartNumber),a=new n.CompleteMultipartUploadCommand({Bucket:m,Key:`${r}${o}`,UploadId:e,MultipartUpload:{Parts:s},...C});try{const e=await w.send(a);if(!e.Key)throw new Error("No Key returned after completing upload");return console.log("Upload completed successfully. Key:",e.Key),e.Key}catch(e){throw console.error("Failed to complete multipart upload:",e),e}},P=async(e,t,o)=>{const r=new n.AbortMultipartUploadCommand({Bucket:m,Key:`${o}${t}`,UploadId:e,...C});try{await w.send(r),console.log("Multipart upload aborted successfully:",e)}catch(e){throw console.error("Failed to abort multipart upload:",e),e}};exports.ApiInstance=f,exports.CookieManager=i,exports.clearAllCookies=e=>l.clear(e),exports.cn=function(...e){return r.twMerge(o.clsx(e))},exports.cookieManager=l,exports.createCookieManager=e=>new i(e),exports.deleteFile=async(e,t)=>{const o=new n.DeleteObjectCommand({Bucket:m,Key:e,...C});try{const r=await w.send(o);return console.log("File deleted successfully:",e),t&&t({loaded:1,total:1}),{ETag:r.DeleteMarker?.toString()}}catch(e){throw console.error("Failed to delete file:",e),e}},exports.getAllCookies=()=>l.getAll(),exports.getAuthToken=()=>{const e=p("token");return e?.access_token?e:null},exports.getCookie=e=>l.get(e),exports.getCookieJSON=p,exports.getFullImageUrl=e=>{const t=process.env.NEXT_PUBLIC_AWS_URL;return e?`${t}${e}`:null},exports.getIframeDocument=()=>{const e=document.getElementById("preview-frame");return e?e?.contentDocument||e?.contentWindow?.document:document},exports.getInitialsFromEmail=e=>{if(!e)return"";const t=e.split("@")[0].split("."),o=t[0]?.charAt(0).toUpperCase()||"",r=t[1]?.charAt(0).toUpperCase()||"";return r?`${o}${r}`:`${o}`},exports.hasCookie=e=>l.has(e),exports.isCookiesEnabled=()=>l.isEnabled(),exports.logoutAuthUser=e=>{d("token"),d("auth"),e?.()},exports.paramsToQueryParams=e=>{const t=new URLSearchParams;return Object.keys(e).forEach(o=>{e[o]&&t.set(o,e[o])}),t},exports.removeCookie=d,exports.setCookie=(e,t,o)=>l.set(e,t,o),exports.setCookieJSON=(e,t,o)=>l.setJSON(e,t,o),exports.uploadFileInChunks=async(e,t,o,r,n,s=new Date(Date.now()).toLocaleDateString("en-GB"))=>{const a=(e=>{if(!(e instanceof File))throw new Error("Invalid file object provided");console.log("File size:",e.size,"Chunk size:",U);const t=[];let o=0;for(;o<e.size;){const r=e.slice(o,o+U);t.push(r),o+=U}return console.log("Total chunks created:",t.length),t})(e);console.log("Starting upload to bucket:",m);const c=await y(t,o,s,e),i=a.map((e,o)=>T(c,e,o+1,t,s).then(e=>{const t=Math.round((o+1)/a.length*100);return n({[r]:t}),e}));try{const e=await Promise.all(i),o=await N(c,e,t,s);return n({[r]:100}),o}catch(e){throw console.error("Upload failed:",e),await P(c,t,s),e}},exports.useWindowWidth=()=>{const[t,o]=e.useState("undefined"!=typeof window?window.innerWidth:void 0);return e.useEffect(()=>{if("undefined"==typeof window)return;const e=()=>{o(window.innerWidth)};return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)},[]),t};
//# sourceMappingURL=index.js.map
